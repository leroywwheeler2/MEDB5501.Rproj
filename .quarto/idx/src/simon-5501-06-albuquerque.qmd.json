{"title":"Regression analysis and diagnostics for Albuquerque housing prices","markdown":{"yaml":{"title":"Regression analysis and diagnostics for Albuquerque housing prices","author":"Steve Simon","format":{"html":{"embed-resources":true}},"date":"2024-08-18"},"headingText":"Load the tidyverse library","containsRefs":false,"markdown":"\n\nThis program reads data on housing prices in Albuquerque, New Mexico in 1993. Find more information in the [data dictionary][dd].\n\n[dd]: https://github.com/pmean/datasets/blob/master/albuquerque-housing.yaml\n\nThis code is placed in the public domain.\n\n\nFor most of your programs, you should load the tidyverse library. The broom package provides a nice way to compute residuals and predicted values. The messages and warnings are suppressed.\n\n```{r setup}\n#| message: false\n#| warning: false\nlibrary(broom)\nlibrary(tidyverse)\n```\n\n## Read the data and view a brief summary\n\nUse the read_csv function to read the data. The glimpse function will produce a brief summary.\n\n```{r read}\nalb <- read_csv(\n  file=\"../data/albuquerque-housing.csv\",\n  col_names=TRUE,\n  col_types=\"nnnnccc\",\n  na=\".\")\nglimpse(alb)\n```\n\n## m1: regression analysis using features to predict price\n\nYou might expect that a house with more features would have a higher sales price. Your first steps are to compute simple descriptive statistics for both the independent variable (features) and the dependent variable (price). Then you should plot the data.\n\n## m1: Calculate descriptive statistics for number of features\n\n```{r features-means}\nalb |>\n  summarise(\n    features_mn=mean(features, na.rm=TRUE),\n    features_sd=sd(features, na.rm=TRUE),\n    features_min=min(features, na.rm=TRUE),\n    features_max=max(features, na.rm=TRUE),\n    n_missing=sum(is.na(features)))\n```\n\nThe average number of features is small (3.5) and the standard deviation (1.4) indicates very little variation. At least one house has zero features and no house has all 13 features.\n\n## m1: Calculate descriptive statistics for price\n\n```{r price-means}\nalb |>\n  summarize(\n    price_mn=mean(price, na.rm=TRUE),\n    price_sd=sd(price, na.rm=TRUE),\n    price_min=min(price, na.rm=TRUE),\n    price_max=max(price, na.rm=TRUE),\n    n_missing=sum(is.na(price)))\n```\n\nThe average price is low (\\$106,000), but the standard deviation (\\$38,000) shows a fair amount of variation. Note that a dollar sign in R has special meaning. To get it to print normally, you have to put a backslash in front of it.\n\n## m1: Plot features versus price\n\n```{r scatterplot-1}\nalb |>\n  ggplot(aes(features, price)) +\n    geom_point() +\n    geom_smooth(method=\"lm\", se=FALSE) +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Number of features\") +\n\t  ylab(\"Price in dollars\")\n```\n\nThere is a weak positive relationship between the number of features and the price of a house.\n\n## m1: Use features to predict price\n\n```{r regression-1}\nm1 <- lm(price~features, data=alb)\nm1\n```\n\nThe estimated average sales price for a house with no features is \\$66,000. This not an extrapolation beyond the range of the data. The estimated average sales price increases by \\$11,000 for each additional feature. This is surprisingly large when you look at what the features are. Perhaps houses with more features are bigger and newer. \n\n## Skip some of the functions for hypothesis tests and p-values\n\nNormally, you would follow this up with various functions like anova(), confint(), or tidy(). This program skips those steps to focus on the diagnostic plots of the residuals.\n\n## m1: Calculate residuals and predicted values\n\n```{r residuals-1}\nr1 <- augment(m1)\nglimpse(r1)\n```\n\nYou could have also used the resid() and predict() functions. No interpretation is needed here, as these numbers are better reviewed using various graphical displays.\n\n## m1: Normal probability plot for residuals\n\n```{r qqplot-1}\nqqnorm(r1$.resid)\n```\n\nThe normal probability plot deviates markedly from a straight line, indicating some possible issues with the normality assumption.\n\nNote that you cannnot use ggtitle, xlab, or ylab with the qqnorm function.\n\n## m1: Histogram for residuals\n\n```{r histogram-1}\nr1 |>\n  ggplot(aes(.resid)) +\n    geom_histogram(\n      binwidth=10000,\n      color=\"black\",\n      fill=\"white\") +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Residuals from m1\")\n```\n\nThe histogram reinforces these concerns. It looks like the data is skewed to the right.\n\n## m1: Plot residuals versus features\n\n```{r residual-scatterplot-1}\nr1 |>\n  ggplot(aes(features, .resid)) + \n    geom_point() +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Number of features\") +\n\t  ylab(\"Residuals from m1\") \n```\n\nThis plot is difficult to interpret. There is some evidence of heterogeneity. It looks, perhaps, like houses with more features also tend to exhibit more variation. There is no evidence of non-linearity.\n\n## m1: Leverage values\n\n```{r leverage-1}\nn <- nrow(r1)\nr1 |> filter(.hat > 3*2/n)\n```\n\nThere are four data points with high leverage. These correspond to the houses with the most and the fewest features.\n\n## m1: Studentized deleted residual\n\n```{r studentized-1}\nr1 |>\n  filter(abs(.std.resid) > 3)\n```\n\nOnly one house, with only an average number of features (3) but with the highest sales price (\\$215,000), might be considered an outlier.\n\n## m1: Cook's distance\n\n```{r cook-1}\nr1 |>\n  filter(.cooksd > 1)\n```\n\nNo houses had a large value for Cook's distance. Even though there are a few high leverage points and one outlier, no single data point has unusually high influence on the predicted values.\n\n## m2: Using features to predict log(price)\n\nBecause there are some concerns about non-normality and heterogeneity, you might consider using a log transformation for price. In this example, a base 10 logarithm is a reasonable choice.\n\n## m2: scatterplot\n\n```{r scatterplot-2}\nalb$log_price <- log10(alb$price)\nalb |>\n  ggplot(aes(features, log_price)) +\n    geom_point() +\n    geom_smooth(method=\"lm\", se=FALSE) +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Number of features\") +\n\t  ylab(\"Log base 10 of price in dollars\")\n```\n\nThere is a weak positive linear relationship between log price and features.\n\n## m2: linear regression on log transformed price\n\n```{r regression-2}\nm2 <- lm(log_price~features, data=alb)\nm2\n```\n\nThe estimated average log price is 4.8 for a house with no features. The estimated average log price increases by 0.043 for each additional feature. These numbers are easier to interpret when transformed back to the original scale.\n\n## m2: Coefficients back transformed to original scale\n\n```{r back-transform-2}\n10^(coef(m2))\n```\n\nThe estimated average price is \\$71,000 for a house with no features. The estimated average price increases by 1.10 (10%) for each additional feature.\n\n## m2: Normal probability plot\n\n```{r qqplot-2}\nr2 <- augment(m2)\nqqnorm(r2$.resid)\n```\n\nThe normal probability plot is close to a straight line, indicating a reasonably close fit to a normal distribution.\n\n## m2: Histogram of residuals\n\n```{r histogram-2}\nr2 |>\n  ggplot(aes(.resid)) +\n    geom_histogram(\n      binwidth=0.05,\n      color=\"black\",\n      fill=\"white\") +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Residuals from m2\")\n```\n\nThe histogram of residuals also indicates a close fit to a normal distribution. The regression model using log price does a better job meeting the normality assumption.\n\n## m2: Plot residuals versus features\n\n```{r residual-scatterplot-2}\nr2 |>\n  ggplot(aes(features, .resid)) + \n    geom_point() +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Number of features\") +\n\t  ylab(\"Residuals from m2\")\n```\n\nThis plot is difficult to interpret. There is certainly no evidence of non-linearity, but perhaps the problems with heterogenity persist even after the log transformation. Houses with zero or one features seem to have less variation than the rest of the data.\n","srcMarkdownNoYaml":"\n\nThis program reads data on housing prices in Albuquerque, New Mexico in 1993. Find more information in the [data dictionary][dd].\n\n[dd]: https://github.com/pmean/datasets/blob/master/albuquerque-housing.yaml\n\nThis code is placed in the public domain.\n\n## Load the tidyverse library\n\nFor most of your programs, you should load the tidyverse library. The broom package provides a nice way to compute residuals and predicted values. The messages and warnings are suppressed.\n\n```{r setup}\n#| message: false\n#| warning: false\nlibrary(broom)\nlibrary(tidyverse)\n```\n\n## Read the data and view a brief summary\n\nUse the read_csv function to read the data. The glimpse function will produce a brief summary.\n\n```{r read}\nalb <- read_csv(\n  file=\"../data/albuquerque-housing.csv\",\n  col_names=TRUE,\n  col_types=\"nnnnccc\",\n  na=\".\")\nglimpse(alb)\n```\n\n## m1: regression analysis using features to predict price\n\nYou might expect that a house with more features would have a higher sales price. Your first steps are to compute simple descriptive statistics for both the independent variable (features) and the dependent variable (price). Then you should plot the data.\n\n## m1: Calculate descriptive statistics for number of features\n\n```{r features-means}\nalb |>\n  summarise(\n    features_mn=mean(features, na.rm=TRUE),\n    features_sd=sd(features, na.rm=TRUE),\n    features_min=min(features, na.rm=TRUE),\n    features_max=max(features, na.rm=TRUE),\n    n_missing=sum(is.na(features)))\n```\n\nThe average number of features is small (3.5) and the standard deviation (1.4) indicates very little variation. At least one house has zero features and no house has all 13 features.\n\n## m1: Calculate descriptive statistics for price\n\n```{r price-means}\nalb |>\n  summarize(\n    price_mn=mean(price, na.rm=TRUE),\n    price_sd=sd(price, na.rm=TRUE),\n    price_min=min(price, na.rm=TRUE),\n    price_max=max(price, na.rm=TRUE),\n    n_missing=sum(is.na(price)))\n```\n\nThe average price is low (\\$106,000), but the standard deviation (\\$38,000) shows a fair amount of variation. Note that a dollar sign in R has special meaning. To get it to print normally, you have to put a backslash in front of it.\n\n## m1: Plot features versus price\n\n```{r scatterplot-1}\nalb |>\n  ggplot(aes(features, price)) +\n    geom_point() +\n    geom_smooth(method=\"lm\", se=FALSE) +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Number of features\") +\n\t  ylab(\"Price in dollars\")\n```\n\nThere is a weak positive relationship between the number of features and the price of a house.\n\n## m1: Use features to predict price\n\n```{r regression-1}\nm1 <- lm(price~features, data=alb)\nm1\n```\n\nThe estimated average sales price for a house with no features is \\$66,000. This not an extrapolation beyond the range of the data. The estimated average sales price increases by \\$11,000 for each additional feature. This is surprisingly large when you look at what the features are. Perhaps houses with more features are bigger and newer. \n\n## Skip some of the functions for hypothesis tests and p-values\n\nNormally, you would follow this up with various functions like anova(), confint(), or tidy(). This program skips those steps to focus on the diagnostic plots of the residuals.\n\n## m1: Calculate residuals and predicted values\n\n```{r residuals-1}\nr1 <- augment(m1)\nglimpse(r1)\n```\n\nYou could have also used the resid() and predict() functions. No interpretation is needed here, as these numbers are better reviewed using various graphical displays.\n\n## m1: Normal probability plot for residuals\n\n```{r qqplot-1}\nqqnorm(r1$.resid)\n```\n\nThe normal probability plot deviates markedly from a straight line, indicating some possible issues with the normality assumption.\n\nNote that you cannnot use ggtitle, xlab, or ylab with the qqnorm function.\n\n## m1: Histogram for residuals\n\n```{r histogram-1}\nr1 |>\n  ggplot(aes(.resid)) +\n    geom_histogram(\n      binwidth=10000,\n      color=\"black\",\n      fill=\"white\") +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Residuals from m1\")\n```\n\nThe histogram reinforces these concerns. It looks like the data is skewed to the right.\n\n## m1: Plot residuals versus features\n\n```{r residual-scatterplot-1}\nr1 |>\n  ggplot(aes(features, .resid)) + \n    geom_point() +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Number of features\") +\n\t  ylab(\"Residuals from m1\") \n```\n\nThis plot is difficult to interpret. There is some evidence of heterogeneity. It looks, perhaps, like houses with more features also tend to exhibit more variation. There is no evidence of non-linearity.\n\n## m1: Leverage values\n\n```{r leverage-1}\nn <- nrow(r1)\nr1 |> filter(.hat > 3*2/n)\n```\n\nThere are four data points with high leverage. These correspond to the houses with the most and the fewest features.\n\n## m1: Studentized deleted residual\n\n```{r studentized-1}\nr1 |>\n  filter(abs(.std.resid) > 3)\n```\n\nOnly one house, with only an average number of features (3) but with the highest sales price (\\$215,000), might be considered an outlier.\n\n## m1: Cook's distance\n\n```{r cook-1}\nr1 |>\n  filter(.cooksd > 1)\n```\n\nNo houses had a large value for Cook's distance. Even though there are a few high leverage points and one outlier, no single data point has unusually high influence on the predicted values.\n\n## m2: Using features to predict log(price)\n\nBecause there are some concerns about non-normality and heterogeneity, you might consider using a log transformation for price. In this example, a base 10 logarithm is a reasonable choice.\n\n## m2: scatterplot\n\n```{r scatterplot-2}\nalb$log_price <- log10(alb$price)\nalb |>\n  ggplot(aes(features, log_price)) +\n    geom_point() +\n    geom_smooth(method=\"lm\", se=FALSE) +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Number of features\") +\n\t  ylab(\"Log base 10 of price in dollars\")\n```\n\nThere is a weak positive linear relationship between log price and features.\n\n## m2: linear regression on log transformed price\n\n```{r regression-2}\nm2 <- lm(log_price~features, data=alb)\nm2\n```\n\nThe estimated average log price is 4.8 for a house with no features. The estimated average log price increases by 0.043 for each additional feature. These numbers are easier to interpret when transformed back to the original scale.\n\n## m2: Coefficients back transformed to original scale\n\n```{r back-transform-2}\n10^(coef(m2))\n```\n\nThe estimated average price is \\$71,000 for a house with no features. The estimated average price increases by 1.10 (10%) for each additional feature.\n\n## m2: Normal probability plot\n\n```{r qqplot-2}\nr2 <- augment(m2)\nqqnorm(r2$.resid)\n```\n\nThe normal probability plot is close to a straight line, indicating a reasonably close fit to a normal distribution.\n\n## m2: Histogram of residuals\n\n```{r histogram-2}\nr2 |>\n  ggplot(aes(.resid)) +\n    geom_histogram(\n      binwidth=0.05,\n      color=\"black\",\n      fill=\"white\") +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Residuals from m2\")\n```\n\nThe histogram of residuals also indicates a close fit to a normal distribution. The regression model using log price does a better job meeting the normality assumption.\n\n## m2: Plot residuals versus features\n\n```{r residual-scatterplot-2}\nr2 |>\n  ggplot(aes(features, .resid)) + \n    geom_point() +\n\t  ggtitle(\"Plot drawn by Steve Simon on 2023-09-24\") +\n\t  xlab(\"Number of features\") +\n\t  ylab(\"Residuals from m2\")\n```\n\nThis plot is difficult to interpret. There is certainly no evidence of non-linearity, but perhaps the problems with heterogenity persist even after the log transformation. Houses with zero or one features seem to have less variation than the rest of the data.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","embed-resources":true,"output-file":"simon-5501-06-albuquerque.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.555","title":"Regression analysis and diagnostics for Albuquerque housing prices","author":"Steve Simon","date":"2024-08-18"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":[]}