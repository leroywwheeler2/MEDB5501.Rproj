{"title":"Analysis of fruitfly data","markdown":{"yaml":{"title":"Analysis of fruitfly data","format":{"html":{"embed-resources":true}}},"headingText":"Load the tidyverse library","containsRefs":false,"markdown":"\n\nThis program reads data on fruit fly longevity. Find more information in the [data dictionary][dd].\n\n[dd]: https://github.com/pmean/data/blob/master/files/fruitfly.yaml\n\nThis code was written by Steve Simon on 2024-10-29 and is placed in the public\ndomain.\n\n\n```{r setup}\n#| message: false\n#| warning: false\nlibrary(broom)\nlibrary(tidyverse)\n```\n\n#### Comments on the code\n\nFor most of your programs, you should load the tidyverse library. The broom \nlibrary converts your output to a nicely arranged dataframe. The messages and\nwarnings are suppressed.\n\n## List the variable names\n\n```{r variable-list}\nvlist <- c(\n  \"id\",\n  \"partners\",\n  \"type\",\n  \"longevity\",\n  \"thorax\",\n  \"sleep\")\n```\n\n#### Comments on the code\n\nWhen a dataset does not have variables on the first line, you need to specify \nthem in the code.\n\n## Read the data and view a brief summary\n\n```{r read}\nfly <- read_fwf(\n  \"../data/fruitfly.txt\",\n  col_types=\"nnnnnn\",\n  fwf_widths(\n    widths=c(2, 2, 2, 3, 5, 3),\n    col_names=vlist))\nglimpse(fly)\n```\n\n#### Comments on the code\n\nThe fruitfly dataset has a fixed width format (fwf). You need to specify the\ncolumns that each variable uses.\n\nNotice that the two categorical variables, partners and type, are actually\nnumbers rather than strings. To avoid having R treat these variables as if\nthey were continuous, use the factor function in some of the code below.\n\n## Create a subset of fruitfly dataset\n\n```{r subset}\nfly |>\n  filter(type != 9) -> fly_subset\n```\n\n#### Comments on the code\n\nIf you exclude the pure control group (No females), you can analyze the two\nfactors, partners and type individually. Partners has two category levels, 1 for\nwhen one female was included in the cage and 8 for when eight females were \nincluded in the cage. Type also has two category levels, 0 for pregnant female\nfly/flies and 1 for virgin fly/flies. A male fly will not mate with a pregnant\nfemales, so you can think of this as a second level of controls. The two factors\nare crossed, meaning that every possible combination of partners and type has \noutcomes measured.\n\n## Draw boxplot of longevity by partners and type\n\n```{r boxplots-partners-type}\n#| fig.width: 6\n#| fig.height: 2.5\nfly_subset |>\n  ggplot(aes(factor(partners), longevity, fill=factor(type))) +\n    geom_boxplot() +\n    xlab(\"Number of partners\") +\n    ylab(\"Lifespan in days\") +\n    ggtitle(\"Graphs drawn by Steve Simon on 2024-10-28\") +\n    labs(fill=\"Female fly type\") +\n    scale_fill_discrete(labels=c(\"Pregnant\", \"Virgin\")) +\n    coord_flip()\n```\n\n#### Interpretation of the output\n\nThe lifespans tend to be quite a bit shorter in cages with 8 virgin females.\nThere are no problems with the homogeneity and normality assumptions.\n\n## Calculate average longevity by partners and type\n\n```{r by-partners-and-type}\n#| message: false\nfly_subset |>\n  group_by(type, partners) |>\n  summarize(\n    longevity_mn=mean(longevity),\n    longevity_sd=sd(longevity),\n    n=n()) -> fly_means\nfly_means\n```\n\n#### Interpretation of the output\n\nThe means show the same pattern as noted above. The standard deviations are all\nroughly the same.\n\n## Draw line graph\n\n```{r line-graph}\nfly_means |>\n  ggplot(aes(\n    factor(partners), \n    longevity_mn, \n    group=factor(type),\n    color=factor(type))) +\n    geom_line(linewidth=2) +\n\texpand_limits(y=range(fly_subset$longevity)) +\n  xlab(\"Number of partners\") +\n  ylab(\"Lifespan in days\") +\n  labs(color=\"Female fly type\") +\n  scale_color_discrete(labels=c(\"Pregnant\", \"Virgin\"))\n```\n\n#### Interpretation of the output\n\nThis plot shows strong evidence of an interaction.\n\nMale fruitflies do appear to have shorter average lifespans when sharing a cage\nwith virgin females compared to pregnant females, but this effect is far \nstronger when the number of female fruitflies is eight rather than one.\n\nThe line for pregnant (sharing a cage with pregnant females) is close to flat,\nindicating that there is little impact of the number of pregnant females on\naverage longevity.\n\n## Analysis of variance including the interaction\n\n```{r anova-with-interaction}\nm1 <- aov(longevity ~ factor(partners)*factor(type), data=fly_subset)\nanova(m1)\n```\n\n#### Interpretation of the output\n\nThere is a statistically significant interaction between the number of female\npartners and the type of partners (pregnant or virgin). When you have an\ninteraction, you do not normally interpret the individual categorical \npredictors.\n\n## Using lm, 1\n\n```{r lm-with-interactions-1}\nm2 <- lm(longevity ~ factor(partners)*factor(type), data=fly_subset)\nanova(m2)\n```\n\n#### Interpretation of the output\n\nThe analysis of variance table is identical when using lm instead of aov.\n\n## Using lm, 2\n\n```{r lm-with-interactions-2}\ntidy(m2)\n```\n\n#### Interpretation of the output\n\nThe lifespan of fruitflies in cages with 8 virgin females is 17 days shorter \nthan what you would expect. If the effect of type and partners were independent,\nyou'd expect to see a 9.4 (= 8.0 + 1.4) day decline on average. The interaction\nshows that this cage is actually 16.6 days worse than that on average.\n\n## Using lm, 3\n\n```{r add-coefficients}\nb <- coef(m2) \nfly_means |>\n  mutate(b0=b[1]) |>\n  mutate(b1=b[2]) |>\n  mutate(b2=b[3]) |>\n  mutate(b3=b[4]) |>\n\tselect(-longevity_sd, -n) -> fly_coefficients\nfly_coefficients[1, 5:7] <- 0\nfly_coefficients[2, 6:7] <- 0\nfly_coefficients[3, c(5,7)] <- 0\nfly_coefficients\n```\n\n#### Comments on the code\n\nThe coef function takes the intercept and slopes from a linear regression model\nand stores them in a vector. The mutate command adds the individual intercept\nand slopes to separate columns. Finally, place zeros in places where the various\nslopes are not needed.\n\n#### Interpretation of the output\n\nThis table is not needed for the data analysis, but is included to illustrate \nhow the regression coefficients are computed in a two factor analysis of \nvariance with an interaction.\n\nThe intercept is the estimated average with both categories each to the \"zero\"\nor reference level. In this case, the average lifespan of flies in a cage with\none pregnant female.\n\nThe first slope coefficient (b1) represents the estimated average difference in\nlifespan between eight pregnant females and one pregnant females.\n\nThe second slope coefficient (b2) represents the estimated average difference in\nlifespan between one pregnant females and one virgin female.\n\nThe third slope coefficient (b3) represents the interaction. It is a measure of\nhow much shorter the average lifespan is with eight virgin females above and\nbeyond the individual impact of eight versus one and virgin versus pregnant.\n\n## Save important files for later use\n\n```{r save}\nsave(\n  fly,\n  fly_subset,\n  file=\"../data/fruitfly.RData\")\n```\n\n#### Comments on the code\n\nIt is always good form to save the important pieces of your data analysis that\nmight be re-used sometime later.\n","srcMarkdownNoYaml":"\n\nThis program reads data on fruit fly longevity. Find more information in the [data dictionary][dd].\n\n[dd]: https://github.com/pmean/data/blob/master/files/fruitfly.yaml\n\nThis code was written by Steve Simon on 2024-10-29 and is placed in the public\ndomain.\n\n## Load the tidyverse library\n\n```{r setup}\n#| message: false\n#| warning: false\nlibrary(broom)\nlibrary(tidyverse)\n```\n\n#### Comments on the code\n\nFor most of your programs, you should load the tidyverse library. The broom \nlibrary converts your output to a nicely arranged dataframe. The messages and\nwarnings are suppressed.\n\n## List the variable names\n\n```{r variable-list}\nvlist <- c(\n  \"id\",\n  \"partners\",\n  \"type\",\n  \"longevity\",\n  \"thorax\",\n  \"sleep\")\n```\n\n#### Comments on the code\n\nWhen a dataset does not have variables on the first line, you need to specify \nthem in the code.\n\n## Read the data and view a brief summary\n\n```{r read}\nfly <- read_fwf(\n  \"../data/fruitfly.txt\",\n  col_types=\"nnnnnn\",\n  fwf_widths(\n    widths=c(2, 2, 2, 3, 5, 3),\n    col_names=vlist))\nglimpse(fly)\n```\n\n#### Comments on the code\n\nThe fruitfly dataset has a fixed width format (fwf). You need to specify the\ncolumns that each variable uses.\n\nNotice that the two categorical variables, partners and type, are actually\nnumbers rather than strings. To avoid having R treat these variables as if\nthey were continuous, use the factor function in some of the code below.\n\n## Create a subset of fruitfly dataset\n\n```{r subset}\nfly |>\n  filter(type != 9) -> fly_subset\n```\n\n#### Comments on the code\n\nIf you exclude the pure control group (No females), you can analyze the two\nfactors, partners and type individually. Partners has two category levels, 1 for\nwhen one female was included in the cage and 8 for when eight females were \nincluded in the cage. Type also has two category levels, 0 for pregnant female\nfly/flies and 1 for virgin fly/flies. A male fly will not mate with a pregnant\nfemales, so you can think of this as a second level of controls. The two factors\nare crossed, meaning that every possible combination of partners and type has \noutcomes measured.\n\n## Draw boxplot of longevity by partners and type\n\n```{r boxplots-partners-type}\n#| fig.width: 6\n#| fig.height: 2.5\nfly_subset |>\n  ggplot(aes(factor(partners), longevity, fill=factor(type))) +\n    geom_boxplot() +\n    xlab(\"Number of partners\") +\n    ylab(\"Lifespan in days\") +\n    ggtitle(\"Graphs drawn by Steve Simon on 2024-10-28\") +\n    labs(fill=\"Female fly type\") +\n    scale_fill_discrete(labels=c(\"Pregnant\", \"Virgin\")) +\n    coord_flip()\n```\n\n#### Interpretation of the output\n\nThe lifespans tend to be quite a bit shorter in cages with 8 virgin females.\nThere are no problems with the homogeneity and normality assumptions.\n\n## Calculate average longevity by partners and type\n\n```{r by-partners-and-type}\n#| message: false\nfly_subset |>\n  group_by(type, partners) |>\n  summarize(\n    longevity_mn=mean(longevity),\n    longevity_sd=sd(longevity),\n    n=n()) -> fly_means\nfly_means\n```\n\n#### Interpretation of the output\n\nThe means show the same pattern as noted above. The standard deviations are all\nroughly the same.\n\n## Draw line graph\n\n```{r line-graph}\nfly_means |>\n  ggplot(aes(\n    factor(partners), \n    longevity_mn, \n    group=factor(type),\n    color=factor(type))) +\n    geom_line(linewidth=2) +\n\texpand_limits(y=range(fly_subset$longevity)) +\n  xlab(\"Number of partners\") +\n  ylab(\"Lifespan in days\") +\n  labs(color=\"Female fly type\") +\n  scale_color_discrete(labels=c(\"Pregnant\", \"Virgin\"))\n```\n\n#### Interpretation of the output\n\nThis plot shows strong evidence of an interaction.\n\nMale fruitflies do appear to have shorter average lifespans when sharing a cage\nwith virgin females compared to pregnant females, but this effect is far \nstronger when the number of female fruitflies is eight rather than one.\n\nThe line for pregnant (sharing a cage with pregnant females) is close to flat,\nindicating that there is little impact of the number of pregnant females on\naverage longevity.\n\n## Analysis of variance including the interaction\n\n```{r anova-with-interaction}\nm1 <- aov(longevity ~ factor(partners)*factor(type), data=fly_subset)\nanova(m1)\n```\n\n#### Interpretation of the output\n\nThere is a statistically significant interaction between the number of female\npartners and the type of partners (pregnant or virgin). When you have an\ninteraction, you do not normally interpret the individual categorical \npredictors.\n\n## Using lm, 1\n\n```{r lm-with-interactions-1}\nm2 <- lm(longevity ~ factor(partners)*factor(type), data=fly_subset)\nanova(m2)\n```\n\n#### Interpretation of the output\n\nThe analysis of variance table is identical when using lm instead of aov.\n\n## Using lm, 2\n\n```{r lm-with-interactions-2}\ntidy(m2)\n```\n\n#### Interpretation of the output\n\nThe lifespan of fruitflies in cages with 8 virgin females is 17 days shorter \nthan what you would expect. If the effect of type and partners were independent,\nyou'd expect to see a 9.4 (= 8.0 + 1.4) day decline on average. The interaction\nshows that this cage is actually 16.6 days worse than that on average.\n\n## Using lm, 3\n\n```{r add-coefficients}\nb <- coef(m2) \nfly_means |>\n  mutate(b0=b[1]) |>\n  mutate(b1=b[2]) |>\n  mutate(b2=b[3]) |>\n  mutate(b3=b[4]) |>\n\tselect(-longevity_sd, -n) -> fly_coefficients\nfly_coefficients[1, 5:7] <- 0\nfly_coefficients[2, 6:7] <- 0\nfly_coefficients[3, c(5,7)] <- 0\nfly_coefficients\n```\n\n#### Comments on the code\n\nThe coef function takes the intercept and slopes from a linear regression model\nand stores them in a vector. The mutate command adds the individual intercept\nand slopes to separate columns. Finally, place zeros in places where the various\nslopes are not needed.\n\n#### Interpretation of the output\n\nThis table is not needed for the data analysis, but is included to illustrate \nhow the regression coefficients are computed in a two factor analysis of \nvariance with an interaction.\n\nThe intercept is the estimated average with both categories each to the \"zero\"\nor reference level. In this case, the average lifespan of flies in a cage with\none pregnant female.\n\nThe first slope coefficient (b1) represents the estimated average difference in\nlifespan between eight pregnant females and one pregnant females.\n\nThe second slope coefficient (b2) represents the estimated average difference in\nlifespan between one pregnant females and one virgin female.\n\nThe third slope coefficient (b3) represents the interaction. It is a measure of\nhow much shorter the average lifespan is with eight virgin females above and\nbeyond the individual impact of eight versus one and virgin versus pregnant.\n\n## Save important files for later use\n\n```{r save}\nsave(\n  fly,\n  fly_subset,\n  file=\"../data/fruitfly.RData\")\n```\n\n#### Comments on the code\n\nIt is always good form to save the important pieces of your data analysis that\nmight be re-used sometime later.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","embed-resources":true,"output-file":"simon-5501-12-fruitfly.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","title":"Analysis of fruitfly data"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":[]}