{
  "hash": "4c62233cbb103e3ba6a8b766580586ff",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis of fruitfly data\"\nformat: \n  html:\n    embed-resources: true\n---\n\n\n\nThis program reads data on fruit fly longevity. Find more information in the [data dictionary][dd].\n\n[dd]: https://github.com/pmean/data/blob/master/files/fruitfly.yaml\n\nThis code was written by Steve Simon on 2024-10-29 and is placed in the public\ndomain.\n\n## Load the tidyverse library\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(broom)\nlibrary(tidyverse)\n```\n:::\n\n\n\n#### Comments on the code\n\nFor most of your programs, you should load the tidyverse library. The broom \nlibrary converts your output to a nicely arranged dataframe. The messages and\nwarnings are suppressed.\n\n## List the variable names\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvlist <- c(\n  \"id\",\n  \"partners\",\n  \"type\",\n  \"longevity\",\n  \"thorax\",\n  \"sleep\")\n```\n:::\n\n\n\n#### Comments on the code\n\nWhen a dataset does not have variables on the first line, you need to specify \nthem in the code.\n\n## Read the data and view a brief summary\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly <- read_fwf(\n  \"../data/fruitfly.txt\",\n  col_types=\"nnnnnn\",\n  fwf_widths(\n    widths=c(2, 2, 2, 3, 5, 3),\n    col_names=vlist))\nglimpse(fly)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 125\nColumns: 6\n$ id        <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…\n$ partners  <dbl> 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, …\n$ type      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ longevity <dbl> 35, 37, 49, 46, 63, 39, 46, 56, 63, 65, 56, 65, 70, 63, 65, …\n$ thorax    <dbl> 0.64, 0.68, 0.68, 0.72, 0.72, 0.76, 0.76, 0.76, 0.76, 0.76, …\n$ sleep     <dbl> 22, 9, 49, 1, 23, 83, 23, 15, 9, 81, 12, 15, 37, 24, 26, 17,…\n```\n\n\n:::\n:::\n\n\n\n#### Comments on the code\n\nThe fruitfly dataset has a fixed width format (fwf). You need to specify the\ncolumns that each variable uses.\n\nNotice that the two categorical variables, partners and type, are actually\nnumbers rather than strings. To avoid having R treat these variables as if\nthey were continuous, use the factor function in some of the code below.\n\n## Create a subset of fruitfly dataset\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly |>\n  filter(type != 9) -> fly_subset\n```\n:::\n\n\n\n#### Comments on the code\n\nIf you exclude the pure control group (No females), you can analyze the two\nfactors, partners and type individually. Partners has two category levels, 1 for\nwhen one female was included in the cage and 8 for when eight females were \nincluded in the cage. Type also has two category levels, 0 for pregnant female\nfly/flies and 1 for virgin fly/flies. A male fly will not mate with a pregnant\nfemales, so you can think of this as a second level of controls. The two factors\nare crossed, meaning that every possible combination of partners and type has \noutcomes measured.\n\n## Draw boxplot of longevity by partners and type\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly_subset |>\n  ggplot(aes(factor(partners), longevity, fill=factor(type))) +\n    geom_boxplot() +\n    xlab(\"Number of partners\") +\n    ylab(\"Lifespan in days\") +\n    ggtitle(\"Graphs drawn by Steve Simon on 2024-10-28\") +\n    labs(fill=\"Female fly type\") +\n    scale_fill_discrete(labels=c(\"Pregnant\", \"Virgin\")) +\n    coord_flip()\n```\n\n::: {.cell-output-display}\n![](simon-5501-12-fruitfly_files/figure-html/boxplots-partners-type-1.png){width=576}\n:::\n:::\n\n\n\n#### Interpretation of the output\n\nThe lifespans tend to be quite a bit shorter in cages with 8 virgin females.\nThere are no problems with the homogeneity and normality assumptions.\n\n## Calculate average longevity by partners and type\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly_subset |>\n  group_by(type, partners) |>\n  summarize(\n    longevity_mn=mean(longevity),\n    longevity_sd=sd(longevity),\n    n=n()) -> fly_means\nfly_means\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 5\n# Groups:   type [2]\n   type partners longevity_mn longevity_sd     n\n  <dbl>    <dbl>        <dbl>        <dbl> <int>\n1     0        1         64.8         15.7    25\n2     0        8         63.4         14.5    25\n3     1        1         56.8         14.9    25\n4     1        8         38.7         12.1    25\n```\n\n\n:::\n:::\n\n\n\n#### Interpretation of the output\n\nThe means show the same pattern as noted above. The standard deviations are all\nroughly the same.\n\n## Draw line graph\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly_means |>\n  ggplot(aes(\n    factor(partners), \n    longevity_mn, \n    group=factor(type),\n    color=factor(type))) +\n    geom_line(linewidth=2) +\n\texpand_limits(y=range(fly_subset$longevity)) +\n  xlab(\"Number of partners\") +\n  ylab(\"Lifespan in days\") +\n  labs(color=\"Female fly type\") +\n  scale_color_discrete(labels=c(\"Pregnant\", \"Virgin\"))\n```\n\n::: {.cell-output-display}\n![](simon-5501-12-fruitfly_files/figure-html/line-graph-1.png){width=672}\n:::\n:::\n\n\n\n#### Interpretation of the output\n\nThis plot shows strong evidence of an interaction.\n\nMale fruitflies do appear to have shorter average lifespans when sharing a cage\nwith virgin females compared to pregnant females, but this effect is far \nstronger when the number of female fruitflies is eight rather than one.\n\nThe line for pregnant (sharing a cage with pregnant females) is close to flat,\nindicating that there is little impact of the number of pregnant females on\naverage longevity.\n\n## Analysis of variance including the interaction\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- aov(longevity ~ factor(partners)*factor(type), data=fly_subset)\nanova(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: longevity\n                              Df  Sum Sq Mean Sq F value    Pr(>F)    \nfactor(partners)               1  2371.7  2371.7  11.489  0.001017 ** \nfactor(type)                   1  6674.9  6674.9  32.335 1.397e-07 ***\nfactor(partners):factor(type)  1  1722.3  1722.3   8.343  0.004785 ** \nResiduals                     96 19817.4   206.4                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n#### Interpretation of the output\n\nThere is a statistically significant interaction between the number of female\npartners and the type of partners (pregnant or virgin). When you have an\ninteraction, you do not normally interpret the individual categorical \npredictors.\n\n## Using lm, 1\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2 <- lm(longevity ~ factor(partners)*factor(type), data=fly_subset)\nanova(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: longevity\n                              Df  Sum Sq Mean Sq F value    Pr(>F)    \nfactor(partners)               1  2371.7  2371.7  11.489  0.001017 ** \nfactor(type)                   1  6674.9  6674.9  32.335 1.397e-07 ***\nfactor(partners):factor(type)  1  1722.3  1722.3   8.343  0.004785 ** \nResiduals                     96 19817.4   206.4                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n#### Interpretation of the output\n\nThe analysis of variance table is identical when using lm instead of aov.\n\n## Using lm, 2\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 5\n  term                            estimate std.error statistic  p.value\n  <chr>                              <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)                        64.8       2.87    22.6   3.87e-40\n2 factor(partners)8                  -1.44      4.06    -0.354 7.24e- 1\n3 factor(type)1                      -8.04      4.06    -1.98  5.07e- 2\n4 factor(partners)8:factor(type)1   -16.6       5.75    -2.89  4.79e- 3\n```\n\n\n:::\n:::\n\n\n\n#### Interpretation of the output\n\nThe lifespan of fruitflies in cages with 8 virgin females is 17 days shorter \nthan what you would expect. If the effect of type and partners were independent,\nyou'd expect to see a 9.4 (= 8.0 + 1.4) day decline on average. The interaction\nshows that this cage is actually 16.6 days worse than that on average.\n\n## Using lm, 3\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb <- coef(m2) \nfly_means |>\n  mutate(b0=b[1]) |>\n  mutate(b1=b[2]) |>\n  mutate(b2=b[3]) |>\n  mutate(b3=b[4]) |>\n\tselect(-longevity_sd, -n) -> fly_coefficients\nfly_coefficients[1, 5:7] <- 0\nfly_coefficients[2, 6:7] <- 0\nfly_coefficients[3, c(5,7)] <- 0\nfly_coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 7\n# Groups:   type [2]\n   type partners longevity_mn    b0    b1    b2    b3\n  <dbl>    <dbl>        <dbl> <dbl> <dbl> <dbl> <dbl>\n1     0        1         64.8  64.8  0     0      0  \n2     0        8         63.4  64.8 -1.44  0      0  \n3     1        1         56.8  64.8  0    -8.04   0  \n4     1        8         38.7  64.8 -1.44 -8.04 -16.6\n```\n\n\n:::\n:::\n\n\n\n#### Comments on the code\n\nThe coef function takes the intercept and slopes from a linear regression model\nand stores them in a vector. The mutate command adds the individual intercept\nand slopes to separate columns. Finally, place zeros in places where the various\nslopes are not needed.\n\n#### Interpretation of the output\n\nThis table is not needed for the data analysis, but is included to illustrate \nhow the regression coefficients are computed in a two factor analysis of \nvariance with an interaction.\n\nThe intercept is the estimated average with both categories each to the \"zero\"\nor reference level. In this case, the average lifespan of flies in a cage with\none pregnant female.\n\nThe first slope coefficient (b1) represents the estimated average difference in\nlifespan between eight pregnant females and one pregnant females.\n\nThe second slope coefficient (b2) represents the estimated average difference in\nlifespan between one pregnant females and one virgin female.\n\nThe third slope coefficient (b3) represents the interaction. It is a measure of\nhow much shorter the average lifespan is with eight virgin females above and\nbeyond the individual impact of eight versus one and virgin versus pregnant.\n\n## Save important files for later use\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsave(\n  fly,\n  fly_subset,\n  file=\"../data/fruitfly.RData\")\n```\n:::\n\n\n\n#### Comments on the code\n\nIt is always good form to save the important pieces of your data analysis that\nmight be re-used sometime later.\n",
    "supporting": [
      "simon-5501-12-fruitfly_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}