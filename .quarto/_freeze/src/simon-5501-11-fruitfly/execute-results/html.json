{
  "hash": "f245fb5e42aefcb69ecea6ba0f20d6ea",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analysis of fruitfly data\"\nformat: \n  html:\n    embed-resources: true\n---\n\n\n\nThis program reads data on fruit fly longevity. Find more information in the [data dictionary][dd].\n\n[dd]: https://github.com/pmean/data/blob/master/files/fruitfly.yaml\n\nThis code was written by Steve Simon on 2024-10-23 and is placed in the public domain.\n\n## Load the tidyverse library\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(broom)\nlibrary(tidyverse)\n```\n:::\n\n\n\nFor most of your programs, you should load the tidyverse library. The broom library converts your output to a nicely arranged dataframe. The messages and warnings are suppressed.\n\n## List the variable names\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfn <- \"https://jse.amstat.org/datasets/fruitfly.dat.txt\"\nvlist <- c(\n  \"id\",\n  \"partners\",\n  \"type\",\n  \"longevity\",\n  \"thorax\",\n  \"sleep\")\n```\n:::\n\n\n\nWhen a dataset does not have variables on the first line, you need to specify them in the code.\n\n## Read the data and view a brief summary\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly <- read_fwf(\n  \"../data/fruitfly.txt\",\n  col_types=\"nnnnnn\",\n  fwf_widths(\n    widths=c(2, 2, 2, 3, 5, 3),\n    col_names=vlist))\nglimpse(fly)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 125\nColumns: 6\n$ id        <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…\n$ partners  <dbl> 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, …\n$ type      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n$ longevity <dbl> 35, 37, 49, 46, 63, 39, 46, 56, 63, 65, 56, 65, 70, 63, 65, …\n$ thorax    <dbl> 0.64, 0.68, 0.68, 0.72, 0.72, 0.76, 0.76, 0.76, 0.76, 0.76, …\n$ sleep     <dbl> 22, 9, 49, 1, 23, 83, 23, 15, 9, 81, 12, 15, 37, 24, 26, 17,…\n```\n\n\n:::\n:::\n\n\n\nThe fruitfly dataset has a fixed width format (fwf). You need to specify the columns that each variable uses.\n\n## Create cage groups\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly$cage <- \n  case_when(\n    fly$partners==0 & fly$type==9 ~ \"No females\",\n    fly$partners==1 & fly$type==0 ~ \"One pregnant female\",\n    fly$partners==1 & fly$type==1 ~ \"One virgin female\",\n    fly$partners==8 & fly$type==0 ~ \"Eight pregnant females\",\n    fly$partners==8 & fly$type==1 ~ \"Eight virgin females\")\n```\n:::\n\n\n\nThe five categories represent different combinations of partners and type.\n\n## Calculate descriptive statistics\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly |>\n  group_by(cage) |>\n  summarize(\n    longevity_mn=mean(longevity),\n    longevity_sd=sd(longevity),\n    n=n())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 4\n  cage                   longevity_mn longevity_sd     n\n  <chr>                         <dbl>        <dbl> <int>\n1 Eight pregnant females         63.4         14.5    25\n2 Eight virgin females           38.7         12.1    25\n3 No females                     63.6         16.5    25\n4 One pregnant female            64.8         15.7    25\n5 One virgin female              56.8         14.9    25\n```\n\n\n:::\n:::\n\n\n\nThe mean lifespan is much lower for the eight virgin females group. The standard deviations are reasonably small and somewhat consistent across all groups.\n\n## Draw boxplot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly |>\n  ggplot(aes(cage, longevity)) +\n    geom_boxplot() +\n    ggtitle(\"Graph drawn by Steve Simon on 2024-10-23\") +\n    xlab(\"Cage residents\") +\n    ylab(\"Lifespan (days)\") +\n    coord_flip()\n```\n\n::: {.cell-output-display}\n![](simon-5501-11-fruitfly_files/figure-html/longevity-boxplot-1.png){width=576}\n:::\n:::\n\n\n\nThe boxplot also shows that the eight virgin females group has lower lifespans.\nThe variation is roughly comparable across all groups. The distributions are\nreasonably symmetric with no outliers.\n\n## One factor analysis of variance for longevity\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- aov(longevity ~ cage, data=fly)\ntidy(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n  term         df  sumsq meansq statistic  p.value\n  <chr>     <dbl>  <dbl>  <dbl>     <dbl>    <dbl>\n1 cage          4 11939.  2985.      13.6  3.52e-9\n2 Residuals   120 26314.   219.      NA   NA      \n```\n\n\n:::\n:::\n\n\n\nThe F-ratio is large and the p-value is small. Conclude that there is a \ndifference among some or all of the population mean lifespans.\n\n## Linear model for longevity, 1\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm2 <- lm(longevity ~ cage, data=fly)\nanova(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: longevity\n           Df Sum Sq Mean Sq F value    Pr(>F)    \ncage        4  11939 2984.82  13.612 3.516e-09 ***\nResiduals 120  26314  219.28                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\nYou can use linear regression to reach the same conclusion. The sums of squares,\ndegrees of freedom, F-ratio, and p-value all match.\n\n## Linear model for longevity, 2\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 5\n  term                     estimate std.error statistic  p.value\n  <chr>                       <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)                63.4        2.96   21.4    9.12e-43\n2 cageEight virgin females  -24.6        4.19   -5.88   3.73e- 8\n3 cageNo females              0.200      4.19    0.0478 9.62e- 1\n4 cageOne pregnant female     1.44       4.19    0.344  7.32e- 1\n5 cageOne virgin female      -6.60       4.19   -1.58   1.18e- 1\n```\n\n\n:::\n:::\n\n\n\nThe linear model creates indicator variable for four out of the five category\nlevels. The regression slopes represent the estimated average difference in \nmeans between each category and the reference category.\n\n## Linear model for longevity, 3\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly |>\n  group_by(cage) |>\n  summarize(longevity_mn=mean(longevity)) |>\n  mutate(reference_mn=first(longevity_mn)) |>\n  mutate(mean_difference=longevity_mn-reference_mn)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 4\n  cage                   longevity_mn reference_mn mean_difference\n  <chr>                         <dbl>        <dbl>           <dbl>\n1 Eight pregnant females         63.4         63.4           0    \n2 Eight virgin females           38.7         63.4         -24.6  \n3 No females                     63.6         63.4           0.200\n4 One pregnant female            64.8         63.4           1.44 \n5 One virgin female              56.8         63.4          -6.6  \n```\n\n\n:::\n:::\n\n\n\nThis table shows how to interpret the intercept and the four slope terms. The\nintercept is the estimated average lifespan for the first level of the\ncategorical variable. The slope terms are the estimated average changes from the\nother levels of the categorical variable and the first level.\n\n## Re-order cage groups, 1\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly$cage_1 <- \n  factor(\n    fly$cage,\n    levels = c(\n      \"No females\",\n      \"One pregnant female\",\n      \"Eight pregnant females\",\n      \"One virgin female\",\n      \"Eight virgin females\"))\n```\n:::\n\n\n\nCompare every category to the No females category (the control condition).\n\n## Re-order cage groups, 2\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm3 <- lm(longevity ~ cage_1, data=fly)\ntidy(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 5\n  term                         estimate std.error statistic  p.value\n  <chr>                           <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)                    63.6        2.96   21.5    6.76e-43\n2 cage_1One pregnant female       1.24       4.19    0.296  7.68e- 1\n3 cage_1Eight pregnant females   -0.200      4.19   -0.0478 9.62e- 1\n4 cage_1One virgin female        -6.80       4.19   -1.62   1.07e- 1\n5 cage_1Eight virgin females    -24.8        4.19   -5.93   2.98e- 8\n```\n\n\n:::\n:::\n\n\n\nThere is one group, eight virgin females, that is statistically significantly different from the no female control group.\n\n## Log transformation, 1\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfly |>\n  mutate(log_longevity=log10(longevity)) -> log_fly\nm3 <- aov(log_longevity ~ cage, data=log_fly)\ntidy(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n  term         df sumsq meansq statistic   p.value\n  <chr>     <dbl> <dbl>  <dbl>     <dbl>     <dbl>\n1 cage          4 0.977 0.244       15.8  1.93e-10\n2 Residuals   120 1.85  0.0154      NA   NA       \n```\n\n\n:::\n:::\n\n\n\nAlthough there are no problems with heterogeneity or non-normality, here is an illustration of how to use a log transformation with analysis of variance.\n\n## Log transformation, 2\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt3 <- TukeyHSD(m3, ordered=TRUE)\nt3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n    factor levels have been ordered\n\nFit: aov(formula = log_longevity ~ cage, data = log_fly)\n\n$cage\n                                                    diff         lwr        upr\nOne virgin female-Eight virgin females      0.1727239664  0.07545440 0.26999353\nNo females-Eight virgin females             0.2246277842  0.12735822 0.32189735\nEight pregnant females-Eight virgin females 0.2248176039  0.12754804 0.32208717\nOne pregnant female-Eight virgin females    0.2348081459  0.13753858 0.33207771\nNo females-One virgin female                0.0519038178 -0.04536575 0.14917338\nEight pregnant females-One virgin female    0.0520936375 -0.04517593 0.14936320\nOne pregnant female-One virgin female       0.0620841794 -0.03518539 0.15935375\nEight pregnant females-No females           0.0001898197 -0.09707975 0.09745939\nOne pregnant female-No females              0.0101803617 -0.08708920 0.10744993\nOne pregnant female-Eight pregnant females  0.0099905420 -0.08727902 0.10726011\n                                                p adj\nOne virgin female-Eight virgin females      0.0000274\nNo females-Eight virgin females             0.0000000\nEight pregnant females-Eight virgin females 0.0000000\nOne pregnant female-Eight virgin females    0.0000000\nNo females-One virgin female                0.5787592\nEight pregnant females-One virgin female    0.5752707\nOne pregnant female-One virgin female       0.3971466\nEight pregnant females-No females           1.0000000\nOne pregnant female-No females              0.9984379\nOne pregnant female-Eight pregnant females  0.9985491\n```\n\n\n:::\n:::\n\n\n\n## Log transformation, 3\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt3$cage |>\n  data.frame() |>\n  select(diff, lwr, upr) |> \n  mutate(\n    diff=10^diff,\n    lwr=10^lwr,\n    upr=10^upr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                                diff       lwr      upr\nOne virgin female-Eight virgin females      1.488415 1.1897464 1.862059\nNo females-Eight virgin females             1.677366 1.3407821 2.098444\nEight pregnant females-Eight virgin females 1.678099 1.3413683 2.099361\nOne pregnant female-Eight virgin females    1.717150 1.3725829 2.148215\nNo females-One virgin female                1.126948 0.9008122 1.409852\nEight pregnant females-One virgin female    1.127441 0.9012060 1.410468\nOne pregnant female-One virgin female       1.153677 0.9221777 1.443290\nEight pregnant females-No females           1.000437 0.7996874 1.251582\nOne pregnant female-No females              1.023718 0.8182967 1.280707\nOne pregnant female-Eight pregnant females  1.023271 0.8179391 1.280148\n```\n\n\n:::\n:::\n\n\n\n## Log transformation, 4\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nt3$cage |>\n  data.frame() |>\n  select(diff, lwr, upr) |> \n  mutate(\n    diff=10^(-diff),\n    upr=10^(-lwr),\n    lwr=10^(-upr))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                                 diff        lwr       upr\nOne virgin female-Eight virgin females      0.6718557 0.14437259 0.8405153\nNo females-Eight virgin females             0.5961729 0.17954226 0.7458333\nEight pregnant females-Eight virgin females 0.5959124 0.17967704 0.7455074\nOne pregnant female-Eight virgin females    0.5823604 0.18682997 0.7285535\nNo females-One virgin female                0.8873525 0.07760517 1.1101093\nEight pregnant females-One virgin female    0.8869648 0.07769191 1.1096242\nOne pregnant female-One virgin female       0.8667938 0.08233989 1.0843897\nEight pregnant females-No females           0.9995630 0.05617090 1.2504886\nOne pregnant female-No females              0.9768315 0.05997211 1.2220506\nOne pregnant female-Eight pregnant females  0.9772585 0.05989838 1.2225849\n```\n\n\n:::\n:::\n\n\n\n## Kruskal-Wallis test\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkruskal.test(longevity ~ cage, data=fly)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tKruskal-Wallis rank sum test\n\ndata:  longevity by cage\nKruskal-Wallis chi-squared = 37.961, df = 4, p-value = 1.142e-07\n```\n\n\n:::\n:::\n\n\n\nIt may not be needed with this particular dataset, but this is an illustration\nof how to use the Kruskal-Wallis test. \n\n## Save important files for later use\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsave(\n  fly,\n  log_fly,\n  file=\"../data/fruitfly.RData\")\n```\n:::",
    "supporting": [
      "simon-5501-11-fruitfly_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}